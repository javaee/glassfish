<?xml version="1.0" encoding="ISO-8859-1"?>


<!DOCTYPE project [
<!ENTITY commonSetup SYSTEM "file:./../../config/properties.xml">
<!ENTITY commonBuild SYSTEM "file:./../../config/common.xml">
<!ENTITY commonRun SYSTEM "file:./../../config/run.xml">
<!ENTITY reporting   SYSTEM "file:./report.xml">
]>

<project name="ejb" default="usage" basedir=".">

    &commonSetup;
    &commonBuild;
    &commonRun;
    &reporting;

    <target name="all">


	<antcall target="start-database"/>

        <ant target="startDomain"/>

        <delete>
           <fileset dir="${env.APS_HOME}" includes="test_results*"/>
        </delete>
        <delete>
           <fileset dir="." includes="*.output"/>
        </delete>
        <record name="ejb.output" action="start" />


        <ant dir="stubs" target="all"/>
        <ant dir="txprop" target="all"/>
        <ant dir="ejbc" target="all"/>  
        <ant dir="ejb31" target="all"/>
        <ant dir="ejb30" target="all"/>
        <ant dir="mdb" target="all"/> 
        <ant dir="timer" target="all"/>
        <ant dir="cmp" target="all"/>  
        <ant dir="sfsb" target="all"/>
        <ant dir="allowedmethods" target="all"/> 


<!-- gradually reenable the existing tests as features come on line

        <ant dir="bmp" target="all"/>  
        <ant dir="jms" target="all"/>  

        <ant dir="util" target="all"/>
-->

        <echo message="Stopping app server instance"/>
        <ant target="stopDomain"/>

	<antcall target="stop-database"/>


        <record name="ejb.output" action="stop" />
        <antcall target="report"/>

    </target>

    <target name="orb_integration">
        <ant dir="ejb30" target="clientview"/>  
        <ant dir="ejb30" target="hello"/>  
        <ant dir="ejbc" target="all"/>
        <ant dir="txprop" target="all"/>  
        <ant dir="stubs" target="all"/>  
<!-- gradually reenable the existing tests as features come on line
        <ant dir="bmp" target="handle"/>  
        <ant dir="bmp" target="txtests"/> 
-->
    </target>

    <target name="start-database" depends="init-common">
        <echo message="Starting database"/>
	<exec executable="${ASADMIN}" failonerror="false">
          <arg line="start-database"/>
	</exec>
    </target>

    <target name="stop-database" depends="init-common">
        <echo message="Stopping database"/>
	<exec executable="${ASADMIN}" failonerror="false">
          <arg line="stop-database"/>
	</exec>
    </target>

    <target name="allowedmethods">
        <record name="allowedmethods.output" action="start" />
            <ant dir="allowedmethods" target="all"/>
        <record name="allowedmethods.output" action="stop" />
        <antcall target="report"/>
    </target>

    <target name="bmp">
        <record name="bmp.output" action="start" />
            <ant dir="bmp" target="all"/>
        <record name="bmp.output" action="stop" />
        <antcall target="report"/>
    </target>

    <target name="ejb30">
        <record name="ejb30.output" action="start" />
            <ant dir="ejb30" target="all"/>
        <record name="ejb30.output" action="stop" />
        <antcall target="report"/>
    </target>

    <target name="ejb31">
        <record name="ejb31.output" action="start" />
            <ant dir="ejb31" target="all"/>
        <record name="ejb31.output" action="stop" />
        <antcall target="report"/>
    </target>

    <target name="ejbc">
        <record name="ejbc.output" action="start" />
            <ant dir="ejbc" target="all"/>
        <record name="ejbc.output" action="stop" />
        <antcall target="report"/>
    </target>

    <target name="jms">
        <record name="jms.output" action="start" />
            <ant dir="jms" target="all"/>
        <record name="jms.output" action="stop" />
        <antcall target="report"/>
    </target>

    <target name="mdb">
        <record name="mdb.output" action="start" />
            <ant dir="mdb" target="all"/>
        <record name="mdb.output" action="stop" />
        <antcall target="report"/>
    </target>

    <target name="stubs">
        <record name="stubs.output" action="start" />
            <ant dir="stubs" target="all"/>
        <record name="stubs.output" action="stop" />
        <antcall target="report"/>
    </target>
    
    <target name="timer">
        <record name="timer.output" action="start" />
            <ant dir="timer" target="all"/>
        <record name="timer.output" action="stop" />
        <antcall target="report"/>
    </target>

    <target name="txprop">
        <record name="txprop.output" action="start" />
            <ant dir="txprop" target="all"/>
        <record name="txprop.output" action="stop" />
        <antcall target="report"/>
    </target>


    <target name="sfsb">
        <record name="sfsb.output" action="start" />
            <ant dir="sfsb" target="all"/>
        <record name="sfsb.output" action="stop" />
        <antcall target="report"/>
    </target>

    <target name="stress">
        <record name="stress.output" action="start" />
            <ant dir="stress" target="all"/>
        <record name="stress.output" action="stop" />
        <antcall target="report"/>
    </target>

   <target name="util">
        <record name="util.output" action="start" />
            <ant dir="util" target="all"/>
        <record name="util.output" action="stop" />
        <antcall target="report"/>
    </target>

    <target name="usage">
	<echo>
		Usage:
			ant all (Executes all the ejb tests)
            ant orb_integration (Executes all ejb-related orb integration tests

			ant allowedmethods (Executes the ejb allowedmethods tests)
			ant bmp (Executes the ejb bmp tests)
			ant ejbc (Executes the ejb ejbc tests)
			ant jms (Executes the ejb jms tests)
			ant mdb (Executes the ejb mdb tests)
			ant stubs (Executes the ejb stubs tests)
			ant timer (Executes the ejb timer tests)
			ant txprop (Executes the ejb txprop tests)
			ant sfsb (Executes the ejb sfsb tests)
			ant stress (Executes the ejb stress tests)
			ant util (Executes the ejb util tests)
			ant ejb30 (Executes the ejb30 tests)
			ant ejb31 (Executes the ejb31 tests)
	</echo>
    </target>
</project>
